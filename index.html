<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>팀 운영비 관리</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <h1 id="teamTitle">팀 운영비 관리</h1>
                <div class="header-controls">
                    <button class="btn-icon" onclick="openSettingsModal()" title="설정"><span>⚙️</span></button>
                    <div class="quarter-selector">
                        <select id="quarterSelect" onchange="changeQuarter()">
                            <option value="1">1분기 (1~3월)</option>
                            <option value="2">2분기 (4~6월)</option>
                            <option value="3">3분기 (7~9월)</option>
                            <option value="4">4분기 (10~12월)</option>
                            <option value="all">전체 (연간)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="budget-overview">
                <div class="budget-item">
                    <span class="label" id="budgetLabel">분기 예산</span>
                    <span class="value" id="budgetAmount">₩435,000</span>
                </div>
                <div class="budget-item">
                    <span class="label">사용 금액</span>
                    <span class="value used" id="totalUsed">₩0</span>
                </div>
                <div class="budget-item">
                    <span class="label">잔여 금액</span>
                    <span class="value remaining" id="totalRemaining">₩435,000</span>
                </div>
            </div>
            <div class="exchange-rate">
                <span class="label">현재 환율 (USD/KRW)</span>
                <span class="value" id="exchangeRate">로딩중...</span>
                <button class="btn-refresh" onclick="fetchExchangeRate()">↻</button>
            </div>
            <div class="data-actions">
                <button class="btn-data" onclick="exportData()">📥 데이터 내보내기</button>
                <button class="btn-data" onclick="document.getElementById('importFile').click()">📤 데이터 가져오기</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="dashboard">대시보드</button>
            <button class="tab" data-tab="members">팀원 관리</button>
            <button class="tab" data-tab="expenses">비용 등록</button>
            <button class="tab" data-tab="history">사용 내역</button>
        </nav>

        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <!-- Monthly Summary -->
                <div class="card">
                    <h2>월별 사용 현황</h2>
                    <div class="monthly-bars" id="monthlyBars">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- Quarter Summary -->
                <div class="card">
                    <h2>분기 요약</h2>
                    <div class="quarter-summary" id="quarterSummary">
                        <div class="progress-ring">
                            <svg viewBox="0 0 100 100">
                                <circle class="bg" cx="50" cy="50" r="45" />
                                <circle class="progress" cx="50" cy="50" r="45" id="progressCircle" />
                            </svg>
                            <div class="progress-text">
                                <span class="percent" id="usagePercent">0%</span>
                                <span class="label">사용률</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Member Usage -->
                <div class="card wide">
                    <h2>팀원별 사용 현황</h2>
                    <div class="member-usage" id="memberUsage">
                        <p class="empty-state">등록된 팀원이 없습니다.</p>
                    </div>
                </div>

                <!-- Recent Expenses -->
                <div class="card wide">
                    <h2>최근 지출 내역</h2>
                    <div class="recent-expenses" id="recentExpenses">
                        <p class="empty-state">등록된 지출이 없습니다.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Members Tab -->
        <section id="members" class="tab-content">
            <div class="card">
                <h2>팀원 등록</h2>
                <form id="memberForm" class="form">
                    <div class="form-group">
                        <label for="memberName">이름</label>
                        <input type="text" id="memberName" placeholder="팀원 이름 입력" required>
                    </div>
                    <div class="form-group">
                        <label for="memberRole">직책</label>
                        <input type="text" id="memberRole" placeholder="직책 입력">
                    </div>
                    <button type="submit" class="btn btn-primary">팀원 추가</button>
                </form>
            </div>

            <div class="card">
                <h2>팀원 목록</h2>
                <div class="member-list" id="memberList">
                    <p class="empty-state">등록된 팀원이 없습니다.</p>
                </div>
            </div>
        </section>

        <!-- Expenses Tab -->
        <section id="expenses" class="tab-content">
            <div class="card">
                <h2>비용 등록</h2>
                <form id="expenseForm" class="form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="expenseMember">팀원 선택</label>
                            <select id="expenseMember" required>
                                <option value="">팀원 선택</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="expenseDate">사용 날짜</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="expenseCategory">사용 항목</label>
                        <select id="expenseCategory" required>
                            <option value="">항목 선택</option>
                            <option value="식비">식비</option>
                            <option value="교통비">교통비</option>
                            <option value="구독서비스">구독 서비스</option>
                            <option value="도서구입">도서 구입</option>
                            <option value="교육비">교육비</option>
                            <option value="사무용품">사무용품</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expenseDescription">상세 내용</label>
                        <input type="text" id="expenseDescription" placeholder="상세 내용 입력" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="expenseCurrency">통화</label>
                            <select id="expenseCurrency">
                                <option value="KRW">₩ 원화 (KRW)</option>
                                <option value="USD">$ 달러 (USD)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="expenseAmount">금액</label>
                            <input type="number" id="expenseAmount" placeholder="금액 입력" step="0.01" required>
                        </div>
                    </div>
                    <div class="converted-amount" id="convertedAmount" style="display: none;">
                        <span class="label">원화 환산:</span>
                        <span class="value" id="convertedValue">₩0</span>
                    </div>
                    <div class="subscription-option" id="subscriptionOption" style="display: none;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="isSubscription">
                            <span>월 정기 구독 (매월 자동 반영)</span>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">비용 등록</button>
                </form>
            </div>
        </section>

        <!-- History Tab -->
        <section id="history" class="tab-content">
            <div class="card">
                <h2>사용 내역</h2>
                <div class="filter-bar">
                    <select id="filterMonth">
                        <option value="all">전체 월</option>
                    </select>
                    <select id="filterMember">
                        <option value="all">전체 팀원</option>
                    </select>
                    <select id="filterCategory">
                        <option value="all">전체 항목</option>
                        <option value="식비">식비</option>
                        <option value="교통비">교통비</option>
                        <option value="구독서비스">구독 서비스</option>
                        <option value="도서구입">도서 구입</option>
                        <option value="교육비">교육비</option>
                        <option value="사무용품">사무용품</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="expense-table-wrapper">
                    <table class="expense-table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>팀원</th>
                                <th>항목</th>
                                <th>내용</th>
                                <th>금액</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="expenseTableBody">
                            <tr class="empty-row">
                                <td colspan="6">등록된 지출이 없습니다.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="history-summary">
                    <div class="summary-item">
                        <span class="label">필터 결과 합계:</span>
                        <span class="value" id="filteredTotal">₩0</span>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>환경 설정</h2>
                <button class="btn-close" onclick="closeSettingsModal()">×</button>
            </div>
            <form id="settingsForm">
                <div class="form-group">
                    <label for="settingTeamName">팀명</label>
                    <input type="text" id="settingTeamName" required>
                </div>
                <div class="form-group">
                    <label for="settingBudget">분기 예산 (₩)</label>
                    <input type="number" id="settingBudget" required min="0" step="1000">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>